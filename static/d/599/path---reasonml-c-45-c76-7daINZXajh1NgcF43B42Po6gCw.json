{"data":{"site":{"siteMetadata":{"title":"My blog","author":"Olek Dubenko"}},"markdownRemark":{"id":"87dfa2eb-20c4-546b-9a6d-a1529a7419e2","excerpt":"Hi I really want to share with you about this magnificent language ReasonML. Before we start let me tell you that this is a gentle introduction for people…","html":"<h2>Hi</h2>\n<p>I really want to share with you about this magnificent language ReasonML.</p>\n<p>Before we start let me tell you that this is a gentle introduction for people mainly coming from javascript beackground (like me). I’m by no means an expert in reason or functional programming and if you are serious about learning reason you should checkout out (after reading this post of course) oficial documentation documentation and <a href=\"http://reasonmlhub.com/exploring-reasonml/toc.html\">awesome book by Dr Axel Rauschmayer</a>.</p>\n<h2>Intro</h2>\n<p>Remember when you first chained <code class=\"language-text\">map</code> calls on array in js? Remember how cool you felt when you wrote your first <code class=\"language-text\">.reduce((a,b) =&gt; a + b)</code>? If you’re like me than you probably found that writing and composing pure functions\njust felt ‘right’. Writing functional code is very satisfying. And while javascript has some cool functional trics built-in (like first class functions, clousers, etc) it still has some flaws (who needs both <code class=\"language-text\">null</code> and <code class=\"language-text\">undefined</code>?) and shortcomings that aren’t trivial to improve/fix because of that whole ‘don’t break the web’ stuff.</p>\n<p>To improve experience of writing code that runs on web several compile-to-js languages popped out. Some were succesfull and some were not. Today I’ll try to show that this yet another language is <a href=\"https://www.youtube.com/watch?v=lzEweA7RPi0\">serious business</a>.</p>\n<p>ReasonML — a functional programming language oriented mainly towards javascript developers. Let’s look at some of the benefits it offers:</p>\n<ul>\n<li>\n<p>Compilation to JS\nIt compiles to javascript. Not only it produces mostly readable and performant javascript code but it happens really fast. TypeScript i really love you but damn your builds are slow.</p>\n</li>\n<li>\n<p>Full-featured battle-tested functional programming language\nReasonML is actually OCaml with different syntax. And while Reason is relatevily new project, OCaml is not. It is more than 20 years old language.</p>\n</li>\n<li>\n<p>Sound type system\nIt means that types do not lie to you. “Pure Reason program has no null bugs.”</p>\n</li>\n<li>\n<p>Familiar syntax\nYou can probably already read it just fine. It looks just like js. (for a reason alright i promise i won’t do reason puns)</p>\n</li>\n</ul>\n<h2>Show, don’t tell</h2>\n<p>After playing with it I had an urge to write something that I never really liked. I never liked writing tree structures and recursive functions. Oh the sweet memories of juggling with pointers and if statements in c++ to make trees and mental gymnastics to figure out how to write that recursive functions. I hated it. Until I tried Reasonml.</p>\n<p>You probably know about N-Body simulation. Also why did everyone still let them get away with naming variables with one letter? And it’s different letter every time (look at k-nn!!)</p>\n<p>There is this approximation of n-body simulation called Barnes–Hut simulation. Using it I want to create a interactive playground with potentialy large amount of bodies. (Something inspired by falling sand game).</p>\n<p>Welcome to my let’s write episode 1 of 500.</p>\n<p>In this post I’ll implement one part of Barnes–Hut simulation which is spatial quadtree. It is not that complicated as it sounds and just means that it divides 2D space into squares and every node in the tree can have up to 4 children. To do a division of 3D space we would need an octatree.</p>\n<p>[picture here pls]</p>\n<p>Walk with me. Process of setting up reason project is described over <a href=\"https://reasonml.github.io/docs/en/installation\">here</a> but if you’re too lazy to click that here are commands to paste in terminal:</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">yarn global add bs-platform\nbsb -init my-new-project -theme basic-reason</code></pre></div>\n<p>Also don’t forget to grab a <a href=\"https://marketplace.visualstudio.com/items?itemName=jaredly.reason-vscode\">plugin</a> for your favorite editor.</p>\n<p>Let’s start from Module called Vector.\nIn Reason every file is a <code class=\"language-text\">Module</code>. Module name has to be capitalized.</p>\n<p>Vector.re</p>\n<div class=\"gatsby-highlight\" data-language=\"reason\"><pre class=\"language-reason\"><code class=\"language-reason\"><span class=\"token keyword\">type</span> t <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  x<span class=\"token punctuation\">:</span> float<span class=\"token punctuation\">,</span>\n  y<span class=\"token punctuation\">:</span> float<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">let</span> make <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">let</span> add <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>v1<span class=\"token punctuation\">,</span> v2<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>x<span class=\"token punctuation\">:</span> v1<span class=\"token punctuation\">.</span>x <span class=\"token operator\">+.</span> v2<span class=\"token punctuation\">.</span>x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">:</span> v1<span class=\"token punctuation\">.</span>y <span class=\"token operator\">+.</span> v2<span class=\"token punctuation\">.</span>y<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">let</span> random <span class=\"token operator\">=</span> max <span class=\"token operator\">=></span> make<span class=\"token punctuation\">(</span><span class=\"token class-name\">Js</span><span class=\"token punctuation\">.</span><span class=\"token class-name\">Math</span><span class=\"token punctuation\">.</span>random<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*.</span> max<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Js</span><span class=\"token punctuation\">.</span><span class=\"token class-name\">Math</span><span class=\"token punctuation\">.</span>random<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*.</span> max<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Everything from module is available in every part of your program by writing for example <code class=\"language-text\">Vector.add</code>. No export/import is needed.</p>\n<p>Notice how it has decalred <code class=\"language-text\">type t</code>? When we want to describe type of vector we would probably called that type <code class=\"language-text\">vector</code> right? But we already have a module <code class=\"language-text\">Vector</code> named like that so in reason there is a convention to use <code class=\"language-text\">t</code> as a name for main type of the module.</p>\n<p>Lets look at function <code class=\"language-text\">make</code></p>\n<div class=\"gatsby-highlight\" data-language=\"reason\"><pre class=\"language-reason\"><code class=\"language-reason\"><span class=\"token keyword\">let</span> make <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Can you guess what it does? One thing that you might notice is that there are no types. That beacuse types are inferred (guessed). By looking at current scope reason can notice that there is a type that has the same shape as the return shape <code class=\"language-text\">{x, y}</code> and from that type it knows that <code class=\"language-text\">x</code> and <code class=\"language-text\">y</code> are floats. Pretty cool, right? And while most of the times it can guess correclty you can still write types yourself.</p>\n<div class=\"gatsby-highlight\" data-language=\"reason\"><pre class=\"language-reason\"><code class=\"language-reason\"><span class=\"token keyword\">let</span> make <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">:</span> float<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">:</span> float<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> t <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>On to the next line! Adding vectors:</p>\n<div class=\"gatsby-highlight\" data-language=\"reason\"><pre class=\"language-reason\"><code class=\"language-reason\"><span class=\"token keyword\">let</span> add <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>v1<span class=\"token punctuation\">,</span> v2<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>x<span class=\"token punctuation\">:</span> v1<span class=\"token punctuation\">.</span>x <span class=\"token operator\">+.</span> v2<span class=\"token punctuation\">.</span>x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">:</span> v1<span class=\"token punctuation\">.</span>y <span class=\"token operator\">+.</span> v2<span class=\"token punctuation\">.</span>y<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Pretty straightforward but wait what are those dots after plus sign? Remember all those jokes from backend devs about how you can write <code class=\"language-text\">[]+![]</code> and get an <code class=\"language-text\">false</code> string in js? Yeah we can’t do that in reason. For adding integers there is <code class=\"language-text\">+</code> operator and for adding floats there is <code class=\"language-text\">+.</code> operator (and it is same with other math operations). <a href=\"https://reasonml.github.io/docs/en/integer-and-float#design-decisions\">That might change in future</a>.</p>\n<div class=\"gatsby-highlight\" data-language=\"reason\"><pre class=\"language-reason\"><code class=\"language-reason\"><span class=\"token keyword\">let</span> random <span class=\"token operator\">=</span> max <span class=\"token operator\">=></span> make<span class=\"token punctuation\">(</span><span class=\"token class-name\">Js</span><span class=\"token punctuation\">.</span><span class=\"token class-name\">Math</span><span class=\"token punctuation\">.</span>random<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*.</span> max<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Js</span><span class=\"token punctuation\">.</span><span class=\"token class-name\">Math</span><span class=\"token punctuation\">.</span>random<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*.</span> max<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>In this function we are calling native js function <code class=\"language-text\">Math.random</code> by using <code class=\"language-text\">Js</code> module.</p>\n<p>Let’s define body as something that has mass and position</p>\n<p>Body.re</p>\n<div class=\"gatsby-highlight\" data-language=\"reason\"><pre class=\"language-reason\"><code class=\"language-reason\"><span class=\"token keyword\">type</span> t <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  mass<span class=\"token punctuation\">:</span> float<span class=\"token punctuation\">,</span>\n  pos<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Vector</span><span class=\"token punctuation\">.</span>t<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">let</span> make <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>mass<span class=\"token punctuation\">:</span> <span class=\"token number\">10.0</span><span class=\"token punctuation\">,</span> pos<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Vector</span><span class=\"token punctuation\">.</span>random<span class=\"token punctuation\">(</span><span class=\"token number\">512.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Next, I’ll add module for bounding box. We will construct quadtree out of theese squares and we will also need to split them into four equal boxes also called quadrants.</p>\n<div class=\"gatsby-highlight\" data-language=\"reason\"><pre class=\"language-reason\"><code class=\"language-reason\"><span class=\"token keyword\">type</span> t <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  topLeft<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Vector</span><span class=\"token punctuation\">.</span>t<span class=\"token punctuation\">,</span>\n  side<span class=\"token punctuation\">:</span> float<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Box definition consists of its’ top left point and size of the side.</p>\n<div class=\"gatsby-highlight\" data-language=\"reason\"><pre class=\"language-reason\"><code class=\"language-reason\"><span class=\"token keyword\">type</span> quadrant <span class=\"token operator\">=</span>\n  <span class=\"token operator\">|</span> <span class=\"token constructor variable\">NE</span>\n  <span class=\"token operator\">|</span> <span class=\"token constructor variable\">NW</span>\n  <span class=\"token operator\">|</span> <span class=\"token constructor variable\">SE</span>\n  <span class=\"token operator\">|</span> <span class=\"token constructor variable\">SW</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Alright something new. What you see here is called <a href=\"https://reasonml.github.io/docs/en/variant\">Variant type</a>. Marked with an exclamation point in reason documents because of how awesome this thing is.</p>\n<p>What we are declaring here is that <code class=\"language-text\">quadrant</code> is a type that can be either of these values: NE, NW, SE, SW. This is a super simple example of a variant type but don’t judge it as a enum just yet. I’ll show more of it later.</p>\n<div class=\"gatsby-highlight\" data-language=\"reason\"><pre class=\"language-reason\"><code class=\"language-reason\"><span class=\"token keyword\">let</span> getSubquadrantBbox <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>bbox<span class=\"token punctuation\">,</span> quadrant<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> halfSide <span class=\"token operator\">=</span> bbox<span class=\"token punctuation\">.</span>side <span class=\"token operator\">/.</span> <span class=\"token number\">2.0</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">let</span> topLeftOffset <span class=\"token operator\">=</span>\n    <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>quadrant<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token operator\">|</span> <span class=\"token constructor variable\">NW</span> <span class=\"token operator\">=></span> <span class=\"token class-name\">Vector</span><span class=\"token punctuation\">.</span>make<span class=\"token punctuation\">(</span><span class=\"token number\">0.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.0</span><span class=\"token punctuation\">)</span>\n    <span class=\"token operator\">|</span> <span class=\"token constructor variable\">NE</span> <span class=\"token operator\">=></span> <span class=\"token class-name\">Vector</span><span class=\"token punctuation\">.</span>make<span class=\"token punctuation\">(</span>halfSide<span class=\"token punctuation\">,</span> <span class=\"token number\">0.0</span><span class=\"token punctuation\">)</span>\n    <span class=\"token operator\">|</span> <span class=\"token constructor variable\">SW</span> <span class=\"token operator\">=></span> <span class=\"token class-name\">Vector</span><span class=\"token punctuation\">.</span>make<span class=\"token punctuation\">(</span><span class=\"token number\">0.0</span><span class=\"token punctuation\">,</span> halfSide<span class=\"token punctuation\">)</span>\n    <span class=\"token operator\">|</span> <span class=\"token constructor variable\">SE</span> <span class=\"token operator\">=></span> <span class=\"token class-name\">Vector</span><span class=\"token punctuation\">.</span>make<span class=\"token punctuation\">(</span>halfSide<span class=\"token punctuation\">,</span> halfSide<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token punctuation\">{</span>side<span class=\"token punctuation\">:</span> halfSide<span class=\"token punctuation\">,</span> topLeft<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Vector</span><span class=\"token punctuation\">.</span>add<span class=\"token punctuation\">(</span>bbox<span class=\"token punctuation\">.</span>topLeft<span class=\"token punctuation\">,</span> topLeftOffset<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>In this function we want to get one of the four possible subquadrants of the box. New size will be exactly half of the current box and then we need to calculate where the new top left point will be. Here the (pattern matching)[https://reasonml.github.io/docs/en/pattern-matching] expression is used. In docs it is called “one of the best features of the language” and I agree. In short, concise way it is hanlding all variants of the quadrant variable. Also it will scream at you if you forget to handle some variant. (Have you ever forgot to handle some action in redux reducer? I sure did) Did you notice that you can assign it to a value?</p>\n<p>Last value in the body of the function is returned so we don’t need to write <code class=\"language-text\">return</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"reason\"><pre class=\"language-reason\"><code class=\"language-reason\"><span class=\"token keyword\">let</span> quadrantFromPoint <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>bbox<span class=\"token punctuation\">,</span> point<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Vector</span><span class=\"token punctuation\">.</span>t<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> <span class=\"token punctuation\">{</span>topLeft<span class=\"token punctuation\">,</span> side<span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> bbox<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> center <span class=\"token operator\">=</span> <span class=\"token class-name\">Vector</span><span class=\"token punctuation\">.</span>add<span class=\"token punctuation\">(</span>topLeft<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Vector</span><span class=\"token punctuation\">.</span>make<span class=\"token punctuation\">(</span>side <span class=\"token operator\">/.</span> <span class=\"token number\">2.0</span><span class=\"token punctuation\">,</span> side <span class=\"token operator\">/.</span> <span class=\"token number\">2.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>point<span class=\"token punctuation\">.</span>x <span class=\"token operator\">></span> center<span class=\"token punctuation\">.</span>x<span class=\"token punctuation\">,</span> point<span class=\"token punctuation\">.</span>y <span class=\"token operator\">></span> center<span class=\"token punctuation\">.</span>x<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">|</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token constructor variable\">SE</span>\n  <span class=\"token operator\">|</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token constructor variable\">NE</span>\n  <span class=\"token operator\">|</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token constructor variable\">SW</span>\n  <span class=\"token operator\">|</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token constructor variable\">SE</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>In this function we return in which quadrant is the point. Beloved in js <a href=\"https://reasonml.github.io/docs/en/destructuring\">destructuring</a> is also here.\nAnd we are using pattern matching on two boolean values because we can.</p>\n<p>With Vector, Body and BBox modules done lets write octotree.</p>\n<p>Tree.re</p>\n<div class=\"gatsby-highlight\" data-language=\"reason\"><pre class=\"language-reason\"><code class=\"language-reason\"><span class=\"token keyword\">type</span> t <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  body<span class=\"token punctuation\">:</span> option<span class=\"token punctuation\">(</span><span class=\"token class-name\">Body</span><span class=\"token punctuation\">.</span>t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  bbox<span class=\"token punctuation\">:</span> <span class=\"token class-name\">BBox</span><span class=\"token punctuation\">.</span>t<span class=\"token punctuation\">,</span>\n  ne<span class=\"token punctuation\">:</span> option<span class=\"token punctuation\">(</span>t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  nw<span class=\"token punctuation\">:</span> option<span class=\"token punctuation\">(</span>t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  se<span class=\"token punctuation\">:</span> option<span class=\"token punctuation\">(</span>t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  sw<span class=\"token punctuation\">:</span> option<span class=\"token punctuation\">(</span>t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>There is a new <code class=\"language-text\">option</code> type here. In reason there are no null or undefined and thats great. Instead <code class=\"language-text\">option</code> type is used for values that can be empty. You can skip this if you’re familiar with Java Optional type.</p>\n<p>Option</p>\n<p>Lets imagine we have a function that does a search and maybe returns string as result.</p>\n<div class=\"gatsby-highlight\" data-language=\"reason\"><pre class=\"language-reason\"><code class=\"language-reason\"><span class=\"token keyword\">let</span> searchResult <span class=\"token operator\">=</span> search<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">/* Does some search and returns option(strgin) */</span></code></pre></div>\n<p>Result can be either <code class=\"language-text\">Some(string)</code> or <code class=\"language-text\">None</code>\nIn fact <code class=\"language-text\">option</code> is just a variant type defined like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"reason\"><pre class=\"language-reason\"><code class=\"language-reason\"><span class=\"token keyword\">type</span> option<span class=\"token punctuation\">(</span><span class=\"token operator\">'</span>a<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token constructor variable\">None</span> <span class=\"token operator\">|</span> <span class=\"token constructor variable\">Some</span><span class=\"token punctuation\">(</span><span class=\"token operator\">'</span>a<span class=\"token punctuation\">)</span></code></pre></div>\n<p>Where <code class=\"language-text\">&#39;a</code> means some type. Similar to T in generics in other languages.</p>\n<p>And to handle such value we can use pattern matching.</p>\n<div class=\"gatsby-highlight\" data-language=\"reason\"><pre class=\"language-reason\"><code class=\"language-reason\"><span class=\"token keyword\">switch</span><span class=\"token punctuation\">(</span>searchResult<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">|</span> <span class=\"token constructor variable\">None</span> <span class=\"token operator\">=></span> <span class=\"token class-name\">Js</span><span class=\"token punctuation\">.</span>log<span class=\"token punctuation\">(</span><span class=\"token string\">\"No result :(\"</span><span class=\"token punctuation\">)</span>\n  <span class=\"token operator\">|</span> <span class=\"token constructor variable\">Some</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token class-name\">Js</span><span class=\"token punctuation\">.</span>log<span class=\"token punctuation\">(</span><span class=\"token string\">\"Result is: \"</span><span class=\"token operator\">+</span><span class=\"token operator\">+</span>result<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>In second case we unpacked <code class=\"language-text\">result</code> from <code class=\"language-text\">Some</code> value and were forced to handle empty result.</p>\n<p>You can read more about Option <a href=\"https://reasonml.github.io/docs/en/null-undefined-option\">here</a>.</p>\n<p>So going back to our tree example. We are defining tree node as record that has a defined bounding box in space, maybe has a body and maybe has four child nodes in four quadrants. This type is recursive.</p>\n<div class=\"gatsby-highlight\" data-language=\"reason\"><pre class=\"language-reason\"><code class=\"language-reason\"><span class=\"token keyword\">let</span> make <span class=\"token operator\">=</span>\n    <span class=\"token punctuation\">(</span>\n      <span class=\"token operator\">~</span>bbox<span class=\"token punctuation\">:</span> <span class=\"token class-name\">BBox</span><span class=\"token punctuation\">.</span>t<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>side<span class=\"token punctuation\">:</span> <span class=\"token number\">512.0</span><span class=\"token punctuation\">,</span> topLeft<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Vector</span><span class=\"token punctuation\">.</span>make<span class=\"token punctuation\">(</span><span class=\"token number\">0.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token operator\">~</span>body<span class=\"token operator\">=</span><span class=\"token constructor variable\">None</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  body<span class=\"token punctuation\">,</span>\n  bbox<span class=\"token punctuation\">,</span>\n  ne<span class=\"token punctuation\">:</span> <span class=\"token constructor variable\">None</span><span class=\"token punctuation\">,</span>\n  nw<span class=\"token punctuation\">:</span> <span class=\"token constructor variable\">None</span><span class=\"token punctuation\">,</span>\n  se<span class=\"token punctuation\">:</span> <span class=\"token constructor variable\">None</span><span class=\"token punctuation\">,</span>\n  sw<span class=\"token punctuation\">:</span> <span class=\"token constructor variable\">None</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Function <code class=\"language-text\">make</code> creates a tree node. It takes two named parameters. To make a parameter named we put a <code class=\"language-text\">~</code> sign before its name. Both of these parametrs have default value defined after <code class=\"language-text\">=</code> sign. To make named parameter optional you can use <code class=\"language-text\">?</code> as default value. Ok so why does it have empty brackets as a third parameter? Because of the curring it is unclear what to do with function when using some of the parameters. Should <code class=\"language-text\">make(~body)</code> return new curried function or should it call <code class=\"language-text\">make</code> function because <code class=\"language-text\">~bbox</code> is optional? For that reason we need to add positional argument (non-labeled) which is conventionally <code class=\"language-text\">()</code>.</p>\n<p>Like in javascript if field name and value are named the same we can write it once</p>\n<div class=\"gatsby-highlight\" data-language=\"reason\"><pre class=\"language-reason\"><code class=\"language-reason\"><span class=\"token keyword\">let</span> a <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  body<span class=\"token punctuation\">:</span> body\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">let</span> b <span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>\n  body\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Both are the same.</p>\n<p>Simple function for returning child from node</p>\n<div class=\"gatsby-highlight\" data-language=\"reason\"><pre class=\"language-reason\"><code class=\"language-reason\"><span class=\"token keyword\">let</span> getNode <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>tree<span class=\"token punctuation\">,</span> quadrant<span class=\"token punctuation\">:</span> <span class=\"token class-name\">BBox</span><span class=\"token punctuation\">.</span>quadrant<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n  <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>quadrant<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">|</span> <span class=\"token constructor variable\">SE</span> <span class=\"token operator\">=></span> tree<span class=\"token punctuation\">.</span>se\n  <span class=\"token operator\">|</span> <span class=\"token constructor variable\">NE</span> <span class=\"token operator\">=></span> tree<span class=\"token punctuation\">.</span>ne\n  <span class=\"token operator\">|</span> <span class=\"token constructor variable\">SW</span> <span class=\"token operator\">=></span> tree<span class=\"token punctuation\">.</span>sw\n  <span class=\"token operator\">|</span> <span class=\"token constructor variable\">NW</span> <span class=\"token operator\">=></span> tree<span class=\"token punctuation\">.</span>nw\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>In this function we define type for quadrant because it is not in scope. For that we would need to open module like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"reason\"><pre class=\"language-reason\"><code class=\"language-reason\"><span class=\"token keyword\">open</span> <span class=\"token constructor variable\">BBox</span></code></pre></div>\n<p>It will make contets of the module visible in scope (not copied) so we could write <code class=\"language-text\">quadrant</code> instead of <code class=\"language-text\">BBox.quadrant</code>.</p>\n<p>Function for adding a child to a node:</p>\n<div class=\"gatsby-highlight\" data-language=\"reason\"><pre class=\"language-reason\"><code class=\"language-reason\"><span class=\"token keyword\">let</span> setNode <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>tree<span class=\"token punctuation\">:</span> t<span class=\"token punctuation\">,</span> where<span class=\"token punctuation\">:</span> <span class=\"token class-name\">BBox</span><span class=\"token punctuation\">.</span>quadrant<span class=\"token punctuation\">,</span> node<span class=\"token punctuation\">:</span> t<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n  <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>where<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">|</span> <span class=\"token constructor variable\">SE</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span><span class=\"token operator\">...</span>tree<span class=\"token punctuation\">,</span> se<span class=\"token punctuation\">:</span> <span class=\"token constructor variable\">Some</span><span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n  <span class=\"token operator\">|</span> <span class=\"token constructor variable\">NE</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span><span class=\"token operator\">...</span>tree<span class=\"token punctuation\">,</span> ne<span class=\"token punctuation\">:</span> <span class=\"token constructor variable\">Some</span><span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n  <span class=\"token operator\">|</span> <span class=\"token constructor variable\">SW</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span><span class=\"token operator\">...</span>tree<span class=\"token punctuation\">,</span> sw<span class=\"token punctuation\">:</span> <span class=\"token constructor variable\">Some</span><span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n  <span class=\"token operator\">|</span> <span class=\"token constructor variable\">NW</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span><span class=\"token operator\">...</span>tree<span class=\"token punctuation\">,</span> nw<span class=\"token punctuation\">:</span> <span class=\"token constructor variable\">Some</span><span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Oh yeah spread operator is also present in Reason!</p>\n<p>Function for creating single node:</p>\n<div class=\"gatsby-highlight\" data-language=\"reason\"><pre class=\"language-reason\"><code class=\"language-reason\"><span class=\"token keyword\">let</span> createNode <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>bbox<span class=\"token punctuation\">:</span> <span class=\"token class-name\">BBox</span><span class=\"token punctuation\">.</span>t<span class=\"token punctuation\">,</span> quadrant<span class=\"token punctuation\">:</span> <span class=\"token class-name\">BBox</span><span class=\"token punctuation\">.</span>quadrant<span class=\"token punctuation\">,</span> body<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Body</span><span class=\"token punctuation\">.</span>t<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> subquadrant <span class=\"token operator\">=</span> <span class=\"token class-name\">BBox</span><span class=\"token punctuation\">.</span>getSubquadrantBbox<span class=\"token punctuation\">(</span>bbox<span class=\"token punctuation\">,</span> quadrant<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  make<span class=\"token punctuation\">(</span><span class=\"token operator\">~</span>bbox<span class=\"token operator\">=</span>subquadrant<span class=\"token punctuation\">,</span> <span class=\"token operator\">~</span>body<span class=\"token operator\">=</span><span class=\"token constructor variable\">Some</span><span class=\"token punctuation\">(</span>body<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Notice how <code class=\"language-text\">body</code> is wrapped in <code class=\"language-text\">Some</code>. Because <code class=\"language-text\">~body</code> parameter is of type <code class=\"language-text\">option</code> we can’t just pass the value.</p>\n<p>Function for insertind a body intro a tree:</p>\n<div class=\"gatsby-highlight\" data-language=\"reason\"><pre class=\"language-reason\"><code class=\"language-reason\"><span class=\"token keyword\">let</span> <span class=\"token keyword\">rec</span> insert <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>tree<span class=\"token punctuation\">:</span> t<span class=\"token punctuation\">,</span> body<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Body</span><span class=\"token punctuation\">.</span>t<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n  <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>tree<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">|</span> <span class=\"token constructor variable\">Some</span><span class=\"token punctuation\">(</span>_<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n    <span class=\"token keyword\">let</span> quadrant <span class=\"token operator\">=</span> <span class=\"token class-name\">BBox</span><span class=\"token punctuation\">.</span>quadrantFromPoint<span class=\"token punctuation\">(</span>tree<span class=\"token punctuation\">.</span>bbox<span class=\"token punctuation\">,</span> body<span class=\"token punctuation\">.</span>pos<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">let</span> child <span class=\"token operator\">=</span> getNode<span class=\"token punctuation\">(</span>tree<span class=\"token punctuation\">,</span> quadrant<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>child<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token operator\">|</span> <span class=\"token constructor variable\">Some</span><span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> insert<span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">,</span> body<span class=\"token punctuation\">)</span>\n    <span class=\"token operator\">|</span> <span class=\"token constructor variable\">None</span> <span class=\"token operator\">=></span> setNode<span class=\"token punctuation\">(</span>tree<span class=\"token punctuation\">,</span> quadrant<span class=\"token punctuation\">,</span> createNode<span class=\"token punctuation\">(</span>tree<span class=\"token punctuation\">.</span>bbox<span class=\"token punctuation\">,</span> quadrant<span class=\"token punctuation\">,</span> body<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token operator\">|</span> <span class=\"token constructor variable\">None</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span><span class=\"token operator\">...</span>tree<span class=\"token punctuation\">,</span> body<span class=\"token punctuation\">:</span> <span class=\"token constructor variable\">Some</span><span class=\"token punctuation\">(</span>body<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Here comes the most interesting part: recursive function for inserting nodes. Look how small it is!! I must admit that this is not first version of this function but after some tries I’m really happy with the result.</p>\n<p>In this function we need to find and/or create a node for body. We either find appropriete box with no body or recursively divide space until we do.</p>\n<p>Compling</p>\n<p>After running <code class=\"language-text\">bsb -make-world</code> it will compile every <code class=\"language-text\">.re</code> file to <code class=\"language-text\">.bs.js</code> and I encourage you to look at the produced code as it is quite readable and interesting. For example options’ <code class=\"language-text\">None</code> value is just an <code class=\"language-text\">undefined</code> how cool is that?</p>\n<p>Next</p>\n<p>In the next part I’ll try to visualize the quadtree using Canvas API and show you how to do JS interop.</p>","frontmatter":{"title":"ReasonML","date":"April 21, 2019","description":null}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/reasonml/","previous":{"fields":{"slug":"/hi-folks/"},"frontmatter":{"title":"New Beginnings"}},"next":null}}